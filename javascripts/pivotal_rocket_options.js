((function(){var a;a=typeof global!="undefined"&&global!==null?global:window,a.PivotalRocketOptions={background_page:chrome.extension.getBackgroundPage(),templates:{},init:function(){return PivotalRocketOptions.init_templates(),PivotalRocketOptions.init_bindings(),PivotalRocketOptions.init_view()},init_templates:function(){return PivotalRocketOptions.templates.account=Hogan.compile($("#account_template").html())},init_bindings:function(){var a=this;return $("#addAccount").click(function(a){return $("#accountBox").addClass("adding"),!1}),$("#cancelAddAccount").click(function(a){return $("#accountBox").removeClass("adding"),!1}),$("#pivotalEmail, #pivotalPassword, #pivotalCompanyName").keydown(function(a){if(13===a.keyCode)return PivotalRocketOptions.add_account()}),$("#confirmAddAccount").click(function(a){return PivotalRocketOptions.add_account(),!1}),$("#accountList").on("click","a.edit_account",function(a){return $(a.target).parents("li.account").removeClass("deleting").addClass("editing"),!1}),$("#accountList").on("click","a.cancel_edit_account",function(a){return $(a.target).parents("li.account").removeClass("editing"),!1}),$("#accountList").on("keydown","input.company_name",function(a){if(13===a.keyCode)return PivotalRocketOptions.update_account(a)}),$("#accountList").on("click","a.confirm_edit_account",function(a){return PivotalRocketOptions.update_account(a),!1}),$("#accountList").on("click","a.delete_account",function(a){return $(a.target).parents("li.account").removeClass("editing").addClass("deleting"),!1}),$("#accountList").on("click","a.cancel_delete_account",function(a){return $(a.target).parents("li.account").removeClass("deleting"),!1}),$("#accountList").on("click","a.confirm_delete_account",function(a){return PivotalRocketOptions.delete_account(a),!1})},init_sort_accounts:function(){return $("#accountList").sortable({placeholder:"ui-state-highlight",dropOnEmpty:!0,handle:"div.sortable_link",update:function(a,b){var c,d,e;return c=$("#accountList").sortable("toArray"),d=function(){var a,b,d;d=[];for(a=0,b=c.length;a<b;a++)e=c[a],d.push($("#"+e).data("accountId"));return d}(),PivotalRocketStorage.sort_accounts(d)}}),$("#accountList").disableSelection()},init_view:function(){return PivotalRocketOptions.account_list()},account_list:function(){var a,b,c,d;$("#accountList").empty();if(PivotalRocketStorage.get_accounts().length>0){d=PivotalRocketStorage.get_accounts();for(b=0,c=d.length;b<c;b++)a=d[b],$("#accountList").append(PivotalRocketOptions.templates.account.render(a))}return PivotalRocketOptions.init_sort_accounts()},add_account:function(){var a,b,c;c=$("#pivotalEmail").val(),a=$("#pivotalPassword").val();if(c.length>0&&a.length>0)return b=new PivotalAuthLib({username:c,password:a,success:function(a,b,c){var d,e;return d=XML2JSON.parse(a,!0),d.person!=null&&(d=d.person),e=$("#pivotalCompanyName").val(),e.length>0&&(d.company_name=e),PivotalRocketStorage.save_account(d),$("#pivotalEmail, #pivotalPassword, #pivotalCompanyName").val(""),$("#pivotalAddError").empty(),$("#accountBox").removeClass("adding"),PivotalRocketOptions.account_list(),$("#loginSpinner").hide(),PivotalRocketOptions.background_page.PivotalRocketBackground.account==null&&(PivotalRocketOptions.background_page.PivotalRocketBackground.account=d),PivotalRocketOptions.background_page.PivotalRocketBackground.initial_sync(d)},error:function(a,b,c){return $("#pivotalAddError").text(c),$("#loginSpinner").hide()},beforeSend:function(a,b){return $("#loginSpinner").show()}})},update_account:function(a){var b,c,d,e;return e=$(a.target).parents("li.account"),c=e.data("accountId"),b=PivotalRocketStorage.find_account(c),b!=null&&(d=e.find("input.company_name").val(),d.length>0?b.company_name=d:b.company_name=null,PivotalRocketStorage.save_account(b)),e.find(".company_name_text").text(b.company_name||"Not set"),e.removeClass("editing")},delete_account:function(a){var b;return b=$(event.target).parents("li.account"),a=b.data("accountId"),PivotalRocketStorage.delete_account(a),0===PivotalRocketStorage.get_accounts().length&&(PivotalRocketOptions.background_page.PivotalRocketBackground.account=null),PivotalRocketOptions.account_list()}},$(function(){return PivotalRocketOptions.init()})})).call(this)
