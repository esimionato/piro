((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=typeof global!="undefined"&&global!==null?global:window,a.PivotalApiLib=function(){function a(a){this.account=a,this.formated_date=b(this.formated_date,this),this.get_activities=b(this.get_activities,this),this.delete_comment=b(this.delete_comment,this),this.add_comment=b(this.add_comment,this),this.delete_task=b(this.delete_task,this),this.update_task=b(this.update_task,this),this.add_task=b(this.add_task,this),this.update_story=b(this.update_story,this),this.add_story=b(this.add_story,this),this.get_story=b(this.get_story,this),this.update_account=b(this.update_account,this),this.get_stories_for_project=b(this.get_stories_for_project,this),this.get_projects=b(this.get_projects,this)}return a.prototype.baseUrl="https://www.pivotaltracker.com/services/v4",a.prototype.get_projects=function(a){return $.ajax({timeout:8e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects",success:a.success,error:a.error})},a.prototype.get_stories_for_project=function(a){var b;return b=encodeURIComponent("owner:"+this.account.initials),a.requester!=null&&a.requester===!0&&(b=encodeURIComponent("requester:"+this.account.initials)),$.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project.id+"/stories?filter="+b,success:function(b,c,d){if(a!=null&&a.success!=null)return a.success(b,c,d,a.project)},error:a.error,complete:a.complete,beforeSend:a.beforeSend})},a.prototype.update_account=function(){var a=this;return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/me",success:function(a,b,c){var d,e,f,g;d=XML2JSON.parse(a,!0),d.person!=null&&(d=d.person);if(d.email!=null)return e=PivotalRocketStorage.get_accounts(),f=function(){var a,b,c;c=[];for(a=0,b=e.length;a<b;a++)g=e[a],g.email!=null?g.email===d.email?c.push(d):c.push(g):c.push(void 0);return c}(),PivotalRocketStorage.set_accounts(f)}})},a.prototype.get_story=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id,type:"GET",success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.add_story=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:"https://www.pivotaltracker.com/services/v3/projects/"+a.project_id+"/stories",type:"POST",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.update_story=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id,type:"PUT",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.add_task=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id+"/tasks",type:"POST",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.update_task=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id+"/tasks/"+a.task_id,type:"PUT",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.delete_task=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id+"/tasks/"+a.task_id,type:"DELETE",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.add_comment=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id+"/comments",type:"POST",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.delete_comment=function(a){return $.ajax({timeout:4e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/projects/"+a.project_id+"/stories/"+a.story_id+"/comments/"+a.comment_id,type:"DELETE",data:a.data,success:a.success,error:a.error,beforeSend:a.beforeSend,complete:a.complete})},a.prototype.get_activities=function(a){var b;return b=this.formated_date(a.from_date),$.ajax({timeout:2e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid},url:""+this.baseUrl+"/activities?limit=100&occurred_since_date="+encodeURIComponent(b),success:a.success})},a.prototype.formated_date=function(a){return""+a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":00"},a}(),a.PivotalAuthLib=function(){function a(a){a.username!=null&&a.password!=null?$.ajax({cache:!1,global:!1,dataType:"xml",url:""+this.baseUrl+"/me",username:a.username,password:a.password,success:a.success,error:a.error,beforeSend:a.beforeSend}):$.ajax({cache:!1,global:!1,dataType:"xml",url:""+this.baseUrl+"/me",headers:{"X-TrackerToken":a.token},success:a.success,error:a.error,beforeSend:a.beforeSend})}return a.prototype.baseUrl="https://www.pivotaltracker.com/services/v4",a}()})).call(this);
