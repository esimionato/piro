((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=typeof global!="undefined"&&global!==null?global:window,a.PivotalApiLib=function(){function a(a){this.account=a,this.update_account=b(this.update_account,this),this.get_stories_for_project=b(this.get_stories_for_project,this),this.get_projects=b(this.get_projects,this),$.ajaxSetup({timeout:6e4,crossDomain:!0,dataType:"xml",headers:{"X-TrackerToken":this.account.token.guid}})}return a.prototype.get_projects=function(a){return $.ajax({url:"https://www.pivotaltracker.com/services/v4/projects",success:a.success,error:a.error})},a.prototype.get_stories_for_project=function(a){return $.ajax({url:"http://www.pivotaltracker.com/services/v4/projects/"+a.project.id+"/stories?filter="+encodeURIComponent("owner:"+this.account.initials),success:a.success,error:a.error})},a.prototype.update_account=function(){var a=this;return $.ajax({url:"https://www.pivotaltracker.com/services/v4/me",success:function(a,b,c){var d,e,f,g;d=XML2JSON.parse(a,!0),d.person!=null&&(d=d.person);if(d.email!=null)return e=PivotalRocketStorage.get_accounts(),f=function(){var a,b,c;c=[];for(a=0,b=e.length;a<b;a++)g=e[a],g.email!=null?g.email===d.email?c.push(d):c.push(g):c.push(void 0);return c}(),PivotalRocketStorage.set_accounts(f)}})},a}(),a.PivotalAuthLib=function(){function a(a){$.ajaxSetup({timeout:6e4,crossDomain:!0,dataType:"xml",headers:{}}),$.ajax({url:"https://www.pivotaltracker.com/services/v4/me",username:a.username,password:a.password,success:a.success,error:a.error})}return a}()})).call(this)
